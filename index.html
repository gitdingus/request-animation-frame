<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Document</title>
  <style>
    body{
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .parent{
      position: relative;
      height: 80vh;
      width: 80vw;
      background: lightblue;
    }

    .child2{
      position: absolute;
      height: 25px;
      width: 25px;
      left: 400px;
      background: brown;
    }
    .child3{
      position: absolute;
      height: 25px;
      width: 25px;
      left: 400px;
      background: white;
      pointer-events:none;
    }
  </style>
</head>
<body>
    <div class="parent">
      <div class="child2"></div>
      <div class="child3"></div>
    </div>

    <script>
      const child3 = document.querySelector('.child3');
      const child2 = document.querySelector('.child2');
      const parent = document.querySelector('.parent');
      let moveIt = false
      parent.addEventListener('pointermove', pointerMove);
      parent.addEventListener('pointerenter', () => moveIt = true);
      parent.addEventListener('pointerout', pointerUp);

      let lastX;
      let initialX = 400;
      let MAX_DISTANCE = 200;
      function pointerMove(e){
      
        if (lastX === undefined){
          lastX = e.offsetX;
        }


        if (moveIt === true){
          let movePixels = (child2.offsetLeft + (e.offsetX - lastX));
          if (Math.abs(Math.abs(movePixels) - initialX) < MAX_DISTANCE){
            child2.style.left = movePixels + "px";
          }
          if (Math.abs(Math.abs(movePixels) - initialX) > MAX_DISTANCE * .75){
            parent.style.background = "red";

          } else{
            parent.style.background = "green";
          }

        }
        lastX = e.offsetX;

        // }
      }

      function pointerUp(e){
        moveIt = false;
        console.log("pointer up");
        if (parent.style.backgroundColor == "green"){
          console.log("init requested animation frame");
          window.requestAnimationFrame(snapBack);
        }
      }

      let startTime = 0;
      let lastDirection = 0;
      function snapBack(timeStamp){

        if (startTime === 0){
          startTime = timeStamp;
        }
        

        elapsed = timeStamp - startTime;

        if (child2.offsetLeft !== initialX){

          let direction = ((initialX - child2.offsetLeft) / (Math.abs(initialX - child2.offsetLeft)));
          let movePixels = (elapsed * .1) * direction;
          let moveTo = child2.offsetLeft + movePixels;

          if (lastDirection === 0){
            lastDirection = direction;
          }
          if (lastDirection === direction){
            child2.style.left = moveTo + "px";
            lastDirection = direction;
            window.requestAnimationFrame(snapBack);
          }
          else { 
            lastDirection = 0;
            console.log(initialX);
            startTime = 0;
            child2.style.left = initialX + "px";

            console.log('fucking stop');
          }
        }
      }


      // const child = document.querySelector('.child');

      // let start, previousTime;
      
      // function step(time){
      //   if (start === undefined){
      //     start = time;
      //   }

      //   const elapsed = time - start;
      //   if (previousTime != time){
      //     let count = Math.min((elapsed*.05)**2, 500);
      //     child.style.transform = `translateX(${count}px)`;
      //     // child.style.left = (elapsed * .07)**2 + 'px';
      //     //child.style.top = elapsed * .1 + 'px';
      //   }

      //   if (elapsed < 2000){
      //     previousTime = time;
      //     window.requestAnimationFrame(step);
      //   }
      // }

      // window.requestAnimationFrame(step);
    </script>
</body>
</html>